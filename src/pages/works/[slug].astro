---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import SunIcon from "@/components/ui/icons/SunIcon.astro";
import MoonIcon from "@/components/ui/icons/MoonIcon.astro";

// getStaticPaths es obligatorio para rutas din√°micas
export async function getStaticPaths() {
  const works = await getCollection('works');
  
  return works.map((work: CollectionEntry<'works'>) => ({
    params: { slug: work.slug },
    props: { work },
  }));
}

// Tipar Astro.props correctamente
interface Props {
  work: CollectionEntry<'works'>;
}

const { work } = Astro.props as Props;
const { Content } = await work.render();
---

<Layout title={work.data.title}>
  <!-- Toggle de tema flotante -->
  <div 
    id="theme-toggle-detail" 
    class="top-8 right-8 z-50 fixed flex justify-center items-center w-14 xl:w-16 h-14 xl:h-16 hover:scale-110 transition-transform cursor-pointer bento"
  >
    <div id="theme-icon-detail" class="relative w-[42px] h-[42px]">
      <SunIcon className="absolute inset-0 w-[42px] h-[42px] theme-icon-sun" />
      <MoonIcon className="absolute inset-0 w-[42px] h-[42px] theme-icon-moon" />
    </div>
  </div>

  <!-- Bot√≥n volver -->
  <a 
    href="/#works-section"
    class="top-8 left-8 z-50 fixed flex items-center gap-2 px-6 py-3 hover:scale-105 transition-transform bento"
  >
    <span class="text-text xl:text-[20px]">‚Üê Volver</span>
  </a>

  <div class="mx-auto mt-20 px-4 xl:px-16 py-8 container">
    <!-- Hero del proyecto -->
    <section class="relative mb-8 h-[400px] xl:h-[600px] overflow-hidden bento">
      <img 
        src={work.data.images[0]} 
        alt={work.data.title}
        class="absolute inset-0 opacity-30 w-full h-full object-cover"
      />
      <div class="z-10 relative flex flex-col justify-center px-8 xl:px-16 h-full">
        <h1 class="mb-4 font-bold text-text xl:text-[72px] text-4xl md:text-5xl leading-tight">
          {work.data.title}
        </h1>
        <p class="opacity-70 max-w-3xl text-text xl:text-[24px] text-lg md:text-xl">
          {work.data.description}
        </p>
      </div>
    </section>

    <!-- Grid: Tecnolog√≠as + Enlaces -->
    <div class="gap-8 grid xl:grid-cols-2 mb-8">
      <!-- Tecnolog√≠as -->
      <section class="p-6 xl:p-8 bento">
        <h2 class="mb-6 font-bold text-orange xl:text-[32px] text-2xl">
          Technologies Used
        </h2>
        <div class="flex flex-wrap gap-4">
          {work.data.technologies.map((tech: string) => (
            <span class="bg-orange/20 px-6 py-3 rounded-full font-semibold text-orange xl:text-[18px]">
              {tech}
            </span>
          ))}
        </div>
      </section>

      <!-- Enlaces -->
      <section class="flex flex-col justify-center gap-6 p-6 xl:p-8 bento">
        <h2 class="mb-2 font-bold text-orange xl:text-[32px] text-2xl">
          Project Links
        </h2>
        <div class="flex flex-col gap-4">
          {work.data.liveUrl && (
            <a 
              href={work.data.liveUrl} 
              target="_blank"
              rel="noopener noreferrer"
              class="bg-orange hover:bg-orange/80 px-8 py-4 rounded-full font-bold text-text xl:text-[20px] text-center transition-colors"
            >
              See project site ->
            </a>
          )}
          {work.data.githubUrl && (
            <a 
              href={work.data.githubUrl} 
              target="_blank"
              rel="noopener noreferrer"
              class="bg-gray-800 hover:bg-gray-700 px-8 py-4 rounded-full font-bold text-text xl:text-[20px] text-center transition-colors"
            >
              üíª Ver c√≥digo en GitHub
            </a>
          )}
        </div>
      </section>
    </div>

    <!-- Galer√≠a de im√°genes -->
    {work.data.images.length > 1 && (
      <section class="mb-8">
        <h2 class="mb-6 px-2 font-bold text-orange xl:text-[32px] text-2xl">
          Project Gallery
        </h2>
        <div class="gap-6 grid md:grid-cols-2">
          {work.data.images.map((img: string, index: number) => (
            <div class="overflow-hidden bento">
              <img 
                src={img} 
                alt={`${work.data.title} - imagen ${index + 1}`}
                class="w-full h-[300px] xl:h-[400px] object-cover hover:scale-105 transition-transform duration-300"
              />
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Contenido Markdown -->
    <article class="mb-8 p-6 xl:p-12 project-content bento">
      <Content />
    </article>

    <!-- Testimonial (si existe) -->
    {work.data.testimonial && (
      <section class="mb-8 p-6 xl:p-12 bento">
        <h2 class="mb-6 font-bold text-orange xl:text-[32px] text-2xl">
          Client Testimonial
        </h2>
        <blockquote class="pl-6 xl:pl-8 border-orange border-l-4">
          <p class="mb-6 text-text xl:text-[32px] text-xl md:text-2xl italic leading-relaxed">
            "{work.data.testimonial.quote}"
          </p>
          <div class="flex items-center gap-4">
            {work.data.testimonial.avatar && (
              <img 
                src={work.data.testimonial.avatar} 
                alt={work.data.testimonial.author}
                class="rounded-full w-12 xl:w-16 h-12 xl:h-16 object-cover"
              />
            )}
            <cite class="font-semibold text-gray-400 xl:text-[24px] text-lg not-italic">
              ‚Äî {work.data.testimonial.author}
            </cite>
          </div>
        </blockquote>
      </section>
    )}

    <!-- Volver a proyectos -->
    <div class="flex justify-center">
      <a 
        href="/#works-section"
        class="bg-orange hover:bg-orange/80 px-12 py-6 rounded-full font-bold text-text xl:text-[20px] transition-colors"
      >
        ‚Üê Ver todos los proyectos
      </a>
    </div>
  </div>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Toggle de tema
    const toggleBtn = document.getElementById('theme-toggle-detail');
    
    toggleBtn?.addEventListener('click', () => {
      // Usar el themeManager global definido en Layout.astro
      // @ts-ignore - themeManager se define globalmente
      window.themeManager?.toggle();
    });
  });
</script>

<style is:global>
  /* Reset y estilos base para el contenido */
  article.project-content {
    color: white;
    font-size: 1rem;
    line-height: 1.7;
  }

  @media (min-width: 768px) {
    article.project-content {
      font-size: 1.125rem;
    }
  }

  /* T√≠tulos H1 - Minimalista */
  article.project-content h1 {
    color: white;
    font-weight: 600;
    font-size: 1.75rem;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    line-height: 1.3;
  }

  @media (min-width: 768px) {
    article.project-content h1 {
      font-size: 2rem;
      margin-top: 4rem;
      margin-bottom: 2rem;
    }
  }

  article.project-content h1:first-child {
    margin-top: 0;
  }

  /* T√≠tulos H2 - Secciones principales, m√°s sutil */
  article.project-content h2 {
    color: #c85400;
    font-weight: 600;
    font-size: 1.5rem;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.4;
  }

  @media (min-width: 768px) {
    article.project-content h2 {
      font-size: 1.75rem;
      margin-top: 3rem;
      margin-bottom: 1.25rem;
    }
  }

  /* T√≠tulos H3 - Subsecciones, m√°s sutil */
  article.project-content h3 {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
    font-size: 1.25rem;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    line-height: 1.4;
  }

  @media (min-width: 768px) {
    article.project-content h3 {
      font-size: 1.375rem;
      margin-top: 2.5rem;
      margin-bottom: 1rem;
    }
  }

  /* T√≠tulos H4 */
  article.project-content h4 {
    color: rgba(255, 255, 255, 0.8);
    font-weight: 600;
    font-size: 1.125rem;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    line-height: 1.5;
  }

  @media (min-width: 768px) {
    article.project-content h4 {
      font-size: 1.25rem;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
    }
  }
  
  /* P√°rrafos */
  article.project-content p {
    line-height: 1.7;
    margin-bottom: 1.25rem;
    color: rgba(255, 255, 255, 0.85);
  }

  @media (min-width: 768px) {
    article.project-content p {
      margin-bottom: 1.5rem;
    }
  }
  
  /* Enlaces */
  article.project-content a {
    color: #c85400;
    text-decoration: underline;
    transition: color 0.2s;
  }
  
  article.project-content a:hover {
    color: #ff6b1a;
  }
  
  /* Listas */
  article.project-content ul,
  article.project-content ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  @media (min-width: 768px) {
    article.project-content ul,
    article.project-content ol {
      margin-bottom: 2rem;
      padding-left: 2rem;
    }
  }

  article.project-content li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.85);
  }

  @media (min-width: 768px) {
    article.project-content li {
      margin-bottom: 0.75rem;
    }
  }
  
  article.project-content ul li::marker {
    color: #c85400;
    font-size: 1.2em;
  }
  
  article.project-content ol li::marker {
    color: #c85400;
    font-weight: bold;
  }
  
  /* Espaciado despu√©s de listas */
  article.project-content ul + h3,
  article.project-content ol + h3,
  article.project-content ul + h4,
  article.project-content ol + h4 {
    margin-top: 2rem;
  }

  article.project-content ul + p,
  article.project-content ol + p {
    margin-top: 1rem;
  }
  
  /* C√≥digo */
  article.project-content code {
    background-color: #1a1a1c;
    color: #ff6b1a;
    padding: 0.2em 0.5em;
    border-radius: 0.375rem;
    font-size: 0.9em;
    border: 1px solid rgba(200, 84, 0, 0.3);
  }
  
  article.project-content pre {
    background-color: #131315;
    padding: 1.5rem;
    border-radius: 0.75rem;
    overflow-x: auto;
    border: 1px solid rgba(200, 84, 0, 0.2);
    margin-bottom: 2rem;
  }
  
  article.project-content pre code {
    background-color: transparent;
    border: none;
    padding: 0;
    color: white;
  }
  
  /* Blockquotes */
  article.project-content blockquote {
    border-left: 4px solid #c85400;
    padding: 1.5rem;
    margin: 4rem 0;
    background-color: rgba(200, 84, 0, 0.1);
    border-radius: 0.5rem;
    font-style: italic;
    color: rgba(255, 255, 255, 0.9);
  }
  
  /* Tablas */
  article.project-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 4rem 0;
  }
  
  article.project-content th {
    background-color: #c85400;
    color: white;
    padding: 1rem;
    text-align: left;
    font-weight: bold;
  }
  
  article.project-content td {
    padding: 1rem;
    border-bottom: 1px solid rgba(200, 84, 0, 0.2);
  }
  
  article.project-content tr:hover {
    background-color: rgba(200, 84, 0, 0.05);
  }
  
  /* Separadores */
  article.project-content hr {
    border: none;
    height: 2px;
    background: linear-gradient(90deg, transparent, #c85400, transparent);
    margin: 5rem 0;
  }
  
  /* Strong y emphasis */
  article.project-content strong {
    color: #ff6b1a;
    font-weight: 700;
  }
  
  article.project-content em {
    color: rgba(255, 255, 255, 0.8);
  }

  /* Modo claro */
  body.light article.project-content {
    color: #1a1a1a;
  }

  body.light article.project-content h1 {
    color: #1a1a1a;
  }

  body.light article.project-content h2 {
    color: #c85400;
  }

  body.light article.project-content h3 {
    color: #1a1a1a;
  }

  body.light article.project-content h4 {
    color: #4b5563;
  }

  body.light article.project-content p {
    color: #4b5563;
  }

  body.light article.project-content li {
    color: #4b5563;
  }

  body.light article.project-content ul li::marker,
  body.light article.project-content ol li::marker {
    color: #c85400;
  }

  body.light article.project-content a {
    color: #c85400;
  }

  body.light article.project-content a:hover {
    color: #ff6b1a;
  }

  body.light article.project-content code {
    background-color: #f3f4f6;
    color: #c85400;
    border-color: rgba(200, 84, 0, 0.2);
  }

  body.light article.project-content pre {
    background-color: #f3f4f6;
    border-color: rgba(200, 84, 0, 0.15);
  }

  body.light article.project-content pre code {
    color: #1a1a1a;
  }

  body.light article.project-content blockquote {
    background-color: rgba(200, 84, 0, 0.05);
    color: #4b5563;
    border-color: #c85400;
  }

  body.light article.project-content table {
    border-color: rgba(200, 84, 0, 0.2);
  }

  body.light article.project-content th {
    background-color: #c85400;
    color: white;
  }

  body.light article.project-content td {
    border-color: rgba(200, 84, 0, 0.15);
    color: #4b5563;
  }

  body.light article.project-content tr:hover {
    background-color: rgba(200, 84, 0, 0.03);
  }

  body.light article.project-content strong {
    color: #c85400;
  }

  body.light article.project-content em {
    color: #6b7280;
  }

  body.light article.project-content hr {
    background: linear-gradient(90deg, transparent, rgba(200, 84, 0, 0.3), transparent);
  }
</style>
